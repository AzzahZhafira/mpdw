---
title: "Tugas Mandiri_Azzah Zhafira Shidiq (G1401231019)"
author: "Azzah Zhafira Shidiq"
date: "`r Sys.Date()`"
output: html_document
---

# Library

```{r}
library("forecast")
library("graphics")
library("TTR")
library("TSA")
library(readxl)
library(ggplot2)
```

# Import Data

```{r}
data <- read_xlsx("C:/Users/USER/OneDrive/Documents/IPB/SEMESTER 5/MPDW/Page Loads.xlsx")

head(data)
```

Ambil 100 baris data pertama dari dataset.

```{r}
data100 <- data[1:100, ]
```

## Eksplorasi Data

Cek apakah ada data yang hilang

```{r}
data$Date <- as.Date(data$Date)
all_dates <- seq(min(data$Date), max(data$Date), by = "day")
missing_dates <- setdiff(all_dates, data$Date)
missing_dates
```

```{r}
anyNA(data100)
```

Artinya juga data berurutan berdasarkan harinya dan tidak ada missing value.\

Mengubah data agar terbaca sebagai data deret waktu dengan fungsi

```{r}
data100.ts <- ts(data100$Page.Loads)
```

Menampilkan ringkasan data

```{r}
summary(data100.ts)
```

Membuat plot data deret waktu

```{r}
ts.plot(data100.ts, xlab="Time Period ", ylab="Page Loads", 
        main = "Time Series Plot")
points(data100.ts)
```

Data memiliki lonjakan lonjakan yang tidak stabil sehingga cocok dengan Single Moving Average (SMA), Double Moving Average (DMA) dan Winter.

# Single Moving Average & Double Moving Average

## Single Moving Average (SMA)

### Pembagian Data

Pembagian data latih dan data uji dilakukan dengan perbandingan 80% data latih dan 20% data uji.

```{r}
# Membagi data latih dan data uji
training_ma <- data100[1:80,]
testing_ma <- data100[81:100,]
train_ma.ts <- ts(training_ma$Page.Loads)
test_ma.ts <- ts(testing_ma$Page.Loads)
```

#### Plot

```{r}
# eksplorasi data
plot(data100.ts, col="red",main="Plot semua data")
points(data100.ts)

# eksplorasi data latih
plot(train_ma.ts, col="blue",main="Plot data latih")
points(train_ma.ts)

# eksplorasi data uji
plot(test_ma.ts, col="blue",main="Plot data uji")
points(test_ma.ts)
```

```{r}
# Eksplorasi dengan GGPLOT
library(ggplot2)
ggplot() + 
  geom_line(data = training_ma, aes(x = Date, y = Page.Loads, col = "Data Latih")) +
  geom_line(data = testing_ma, aes(x = Date, y = Page.Loads, col = "Data Uji")) +
  labs(x = "Periode Waktu", y = "Debit Aliran Sungai", color = "Legend") +
  scale_colour_manual(name="Keterangan:", breaks = c("Data Latih", "Data Uji"),
                      values = c("blue", "red")) + 
  theme_bw() + theme(legend.position = "bottom",
                     plot.caption = element_text(hjust=0.5, size=12))
```

```{r}
data.sma <- SMA(train_ma.ts, n=4)
data.sma
```

```{r}
data.ramal <- c(NA,data.sma)
data.ramal #forecast 1 periode ke depan
```

Selanjutnya akan dilakukan peramalan sejumlah data uji yaitu 24 periode. Pada metode SMA, hasil peramalan 24 periode ke depan akan bernilai sama dengan hasil peramalan 1 periode kedepan. Dalam hal ini akan dilakukan pengguabungan data aktual train, data hasil pemulusan dan data hasil ramalan 24 periode kedepan.

```{r}
data.gab <- cbind(
  aktual=c(train_ma.ts,rep(NA,24)),
  pemulusan=c(data.sma,rep(NA,24)),
  ramalan=c(data.ramal,rep(data.ramal[length(data.ramal)],23)))

data.gab 
```

Plot data deret waktu dari hasil peramalan

```{r}
ts.plot(data100.ts, xlab="Date ", ylab="Page Loads", main= "SMA N=4 Data Page Loads")
points(data100.ts)
lines(data.gab[,2],col="green",lwd=2)
lines(data.gab[,3],col="red",lwd=2)
legend("topleft",c("data aktual","data pemulusan","data peramalan"), lty=8, col=c("black","green","red"), cex=0.5)
```

Selanjutnya perhitungan akurasi dilakukan dengan ukuran akurasi *Sum Squares Error* (SSE), *Mean Square Error* (MSE) dan *Mean Absolute Percentage Error* (MAPE). Perhitungan akurasi dilakukan baik pada data latih maupun pada data uji.

```{r}
#Menghitung nilai keakuratan data latih
error_train.sma = train_ma.ts-data.ramal[1:length(train_ma.ts)]

SSE_train.sma = sum(error_train.sma[5:length(train_ma.ts)]^2)
MSE_train.sma = mean(error_train.sma[5:length(train_ma.ts)]^2)
MAPE_train.sma = mean(abs((error_train.sma[5:length(train_ma.ts)]/train_ma.ts[5:length(train_ma.ts)])*100))

akurasi_train.sma <- matrix(c(SSE_train.sma, MSE_train.sma, MAPE_train.sma))
row.names(akurasi_train.sma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_train.sma) <- c("Akurasi m = 4")
akurasi_train.sma
```

Dalam hal ini nilai MAPE data latih pada metode pemulusan SMA lebih dari 30%, nilai ini dapat dikategorikan sebagai nilai akurasi yang kurung baik. Selanjutnya dilakukan perhitungan nilai MAPE data uji pada metode pemulusan SMA.

```{r}
#Menghitung nilai keakuratan data uji
error_test.sma = test_ma.ts-data.gab[81:100,3]
SSE_test.sma = sum(error_test.sma^2)
MSE_test.sma = mean(error_test.sma^2)
MAPE_test.sma = mean(abs((error_test.sma/test_ma.ts*100)))

akurasi_test.sma <- matrix(c(SSE_test.sma, MSE_test.sma, MAPE_test.sma))
row.names(akurasi_test.sma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_test.sma) <- c("Akurasi m = 4")
akurasi_test.sma
```

Perhitungan akurasi menggunakan data latih menghasilkan nilai MAPE yang lebih dari 30% sehingga nilai akurasi ini dapat dikategorikan sebagai nilai akurasi yang tidak cukup baik.

## Double Moving Average (DMA)

Metode pemulusan Double Moving Average (DMA) pada dasarnya mirip dengan SMA. Namun demikian, metode ini lebih cocok digunakan untuk pola data trend. Proses pemulusan dengan rata rata dalam metode ini dilakukan sebanyak 2 kali.

```{r}
dma <- SMA(data.sma, n = 4)
At <- 2*data.sma - dma
Bt <- 2/(4-1)*(data.sma - dma)
data.dma<- At+Bt
data.ramal2<- c(NA, data.dma)

t = 1:24
f = c()

for (i in t) {
  f[i] = At[length(At)] + Bt[length(Bt)]*(i)
}

data.gab2 <- cbind(aktual = c(train_ma.ts,rep(NA,24)),
                   pemulusan1 = c(data.sma,rep(NA,24)),
                   pemulusan2 = c(data.dma, rep(NA,24)),
                   At = c(At, rep(NA,24)), 
                   Bt = c(Bt,rep(NA,24)),
                   ramalan = c(data.ramal2, f[-1]))
data.gab2

```

Hasil pemulusan menggunakan metode DMA divisualisasikan sebagai berikut.

```{r}
ts.plot(data100.ts, xlab="Date", ylab="Page Loads", main= "DMA N=4 Data Page Loads")
points(data100.ts)
lines(data.gab2[,3],col="green",lwd=2)
lines(data.gab2[,6],col="red",lwd=2)
legend("topleft",c("data aktual","data pemulusan","data peramalan"), lty=8, col=c("black","green","red"), cex=0.8)

```

Selanjutnya perhitungan akurasi dilakukan baik pada data latih maupun data uji. Perhitungan akurasi dilakukan dengan ukuran akurasi SSE, MSE dan MAPE.

```{r}
#Menghitung nilai keakuratan data latih
error_train.dma = train_ma.ts-data.ramal2[1:length(train_ma.ts)]
SSE_train.dma = sum(error_train.dma[8:length(train_ma.ts)]^2)
MSE_train.dma = mean(error_train.dma[8:length(train_ma.ts)]^2)
MAPE_train.dma = mean(abs((error_train.dma[8:length(train_ma.ts)] / train_ma.ts[8:length(train_ma.ts)])*100))

akurasi_train.dma <- matrix(c(SSE_train.dma, MSE_train.dma, MAPE_train.dma))
row.names(akurasi_train.dma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_train.dma) <- c("Akurasi m = 4")
akurasi_train.dma
```

Perhitungan akurasi pada data latih menggunakan nilai MAPE menghasilkan nilai MAPE yang lebih dari 30% sehingga dikategorikan sangat baik. Selanjutnya, perhitungan nilai akurasi dilakukan pada data uji.

```{r}
#Menghitung nilai keakuratan data uji
error_test.dma = test_ma.ts-data.gab2[81:100,6]
SSE_test.dma = sum(error_test.dma^2)
MSE_test.dma = mean(error_test.dma^2)
MAPE_test.dma = mean(abs((error_test.dma/test_ma.ts*100)))

akurasi_test.dma <- matrix(c(SSE_test.dma, MSE_test.dma, MAPE_test.dma))
row.names(akurasi_test.dma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_test.dma) <- c("Akurasi m = 4")
akurasi_test.dma
```

Perhitungan akurasi menggunakan data uji menghasilkan nilai MAPE yang lebih dari 30% sehingga nilai akurasi ini dapat dikategorikan sebagai nilai akurasi yang tidak baik baik.

Pada data latih dan data uji, metode SMA lebih baik dibandingkan dengan metode DMA. Namun ditinjau dari nilai MAPE, kedua metode tersebut masit tidak cukup baik untuk model.

# WINTER

## Pemulusan Data Musiman

```{r}
#membagi data menjadi training dan testing
training<-data100[1:80,2]
testing<-data100[81:100,2]
training.ts<-ts(training, frequency = 7)
testing.ts<-ts(testing, frequency = 7)
```

Plot data deret waktu

```{r}
#Membuat plot time series
plot(data100.ts, col="red",main="Plot semua data")
points(data100.ts)

plot(training.ts, col="blue",main="Plot data latih")
points(training.ts)

plot(testing.ts, col="green",main="Plot data uji")
points(testing.ts)
```

### Winter Aditif

Perhitungan dengan model aditif dilakukan jika plot data asli menunjukkan fluktuasi musiman yang relatif stabil (konstan).

#### Pemulusan

```{r}
#Pemulusan dengan winter aditif 
winter1 <- HoltWinters(training.ts, alpha=0.2, beta=0.1, gamma=0.1, seasonal = "additive")
winter1$fitted
xhat1 <- winter1$fitted[,2]

winter1.opt<- HoltWinters(training.ts, alpha= NULL,  beta = NULL, gamma = NULL, seasonal = "additive")
winter1.opt
winter1.opt$fitted
xhat1.opt <- winter1.opt$fitted[,2]
```

#### Peramalan

```{r}
#Forecast
forecast1 <- predict(winter1, n.ahead = 20)
forecast1.opt <- predict(winter1.opt, n.ahead = 20)
```

#### Plot Deret Waktu

```{r}
#Plot time series
plot(training.ts,main="Winter 0.2;0.1;0.1",type="l",col="black",
     xlim=c(1,25),pch=12)
lines(xhat1,type="l",col="red")
lines(xhat1.opt,type="l",col="blue")
lines(forecast1,type="l",col="red")
lines(forecast1.opt,type="l",col="blue")
legend("topleft",c("Actual Data",expression(paste(winter1)),
                   expression(paste(winter1.opt))),cex=0.5,
       col=c("black","red","blue"),lty=1)
```

#### Akurasi Data Latih

```{r}
# Akurasi data training

# SSE, MSE, RMSE Winter 1
SSE1  <- winter1$SSE
MSE1  <- winter1$SSE / length(training.ts)
RMSE1 <- sqrt(MSE1)

akurasi1 <- matrix(c(SSE1, MSE1, RMSE1))
row.names(akurasi1) <- c("SSE", "MSE", "RMSE")
colnames(akurasi1)  <- c("Akurasi")
akurasi1

# SSE, MSE, RMSE Winter 1 optimal
SSE1.opt <- winter1.opt$SSE
MSE1.opt <- winter1.opt$SSE / length(training.ts)
RMSE1.opt <- sqrt(MSE1.opt)

akurasi1.opt <- matrix(c(SSE1.opt, MSE1.opt, RMSE1.opt))
row.names(akurasi1.opt) <- c("SSE1.opt", "MSE1.opt", "RMSE1.opt")
colnames(akurasi1.opt) <- c("Akurasi")
akurasi1.opt

# Data frame akurasi gabungan
akurasi1.train <- data.frame(
  Model_Winter = c("Winter 1", "Winter1 optimal"),
  Nilai_SSE = c(SSE1, SSE1.opt),
  Nilai_MSE = c(MSE1, MSE1.opt),
  Nilai_RMSE = c(RMSE1, RMSE1.opt)
)

# Hitung MAPE
pred1 <- winter1$fitted[,2]  
actual1 <- training.ts       

pred1.opt <- winter1.opt$fitted[,2]
MAPE1.opt <- mean(abs((training.ts - pred1.opt) / training.ts)) * 100


# Tambahkan MAPE ke data frame
akurasi1.train$Nilai_MAPE <- c(MAPE1, MAPE1.opt)

# Tampilkan tabel lengkap
akurasi1.train
```

**Hasil:** Pada data training jika dilihat dari nilai SSE dan nilai RMSE, maka Winnter 1 optimal lebih akurat dalam memprediksi nilai aktual dibandingkan Winter biasa. Nilai MAPE Winter 1 optimal \< Winter 1 dan juga nilainya kurang dari 30%. Sehingga dapat dikatakan bahwa Winter optimal memiliki model yang lebih bai dari model Winter biasa.

#### Akurasi Data Uji

```{r}
#Akurasi Data Testing

forecast1.vec <- as.vector(forecast1[,1])
forecast1.opt.vec <- as.vector(forecast1.opt[,1])
testing.vec <- as.vector(testing.ts[,1])

# Hitung selisih dan error untuk data testing
selisih1 <- forecast1.vec - testing.vec
SSEtesting1 <- sum(selisih1^2)
MSEtesting1 <- SSEtesting1 / length(testing.vec)
RMSEtesting1 <- sqrt(MSEtesting1)

selisih1.opt <- forecast1.opt.vec - testing.vec
SSEtesting1.opt <- sum(selisih1.opt^2)
MSEtesting1.opt <- SSEtesting1.opt / length(testing.vec)
RMSEtesting1.opt <- sqrt(MSEtesting1.opt)

# Hitung MAPE untuk data testing
MAPEtesting1 <- mean(abs((testing.vec - forecast1.vec) / testing.vec)) * 100
MAPEtesting1.opt <- mean(abs((testing.vec - forecast1.opt.vec) / testing.vec)) * 100

# Buat data frame akurasi data testing
akurasi1.testing <- data.frame(
  Model_Winter = c("Winter 1", "Winter1 optimal"),
  Nilai_SSE = c(SSEtesting1, SSEtesting1.opt),
  Nilai_MSE = c(MSEtesting1, MSEtesting1.opt),
  Nilai_RMSE = c(RMSEtesting1, RMSEtesting1.opt),
  Nilai_MAPE = c(MAPEtesting1, MAPEtesting1.opt)
)

# Tampilkan tabel akurasi data testing
akurasi1.testing
```

**Hasil:** Pada data testing, nilai SSE, RMSE, dan MAPE menunjukkan bahwa Winter 1 biasa lebih akurat dibanding Winter 1 optimal, karena error-nya lebih kecil. Namun, nilai MAPE masih lebih dari 30%, sehingga akurasi prediksi data testing tergolong tidak cukup baik.

### Winter Multiplikatif

Model multiplikatif digunakan cocok digunakan jika plot data asli menunjukkan fluktuasi musiman yang bervariasi.

#### Pemulusan

```{r}
#Pemulusan dengan winter multiplikatif 
winter2 <- HoltWinters(training.ts,alpha=0.2,beta=0.1,gamma=0.3,seasonal = "multiplicative")
winter2$fitted
xhat2 <- winter2$fitted[,2]

winter2.opt<- HoltWinters(training.ts, alpha= NULL,  beta = NULL, gamma = NULL, seasonal = "multiplicative")
winter2.opt$fitted
xhat2.opt <- winter2.opt$fitted[,2]
```

#### Peramalan

```{r}
#Forecast
forecast2 <- predict(winter2, n.ahead = 20)
forecast2.opt <- predict(winter2.opt, n.ahead = 20)
```

#### Plot Deret Waktu

```{r}
#Plot time series
plot(training.ts,main="Winter 0.2;0.1;0.1",type="l",col="black",
     xlim=c(1,25),pch=12)
lines(xhat2,type="l",col="red")
lines(xhat2.opt,type="l",col="blue")
lines(forecast2,type="l",col="red")
lines(forecast2.opt,type="l",col="blue")
legend("topleft",c("Actual Data",expression(paste(winter2)),
                   expression(paste(winter2.opt))),cex=0.5,
       col=c("black","red","blue"),lty=1)
```

#### Akurasi Data Latih

```{r}
#Akurasi data training Winter 2

# SSE, MSE, RMSE Winter 2
SSE2 <- winter2$SSE
MSE2 <- winter2$SSE / length(training.ts)
RMSE2 <- sqrt(MSE2)

akurasi2 <- matrix(c(SSE2, MSE2, RMSE2))
row.names(akurasi2) <- c("SSE2", "MSE2", "RMSE2")
colnames(akurasi2) <- c("Akurasi lamda=0.2")
akurasi2

# SSE, MSE, RMSE Winter 2 optimal
SSE2.opt <- winter2.opt$SSE
MSE2.opt <- winter2.opt$SSE / length(training.ts)
RMSE2.opt <- sqrt(MSE2.opt)

akurasi2.opt <- matrix(c(SSE2.opt, MSE2.opt, RMSE2.opt))
row.names(akurasi2.opt) <- c("SSE2.opt", "MSE2.opt", "RMSE2.opt")
colnames(akurasi2.opt) <- c("Akurasi")
akurasi2.opt

# Data frame akurasi gabungan
akurasi2.train <- data.frame(
  Model_Winter = c("Winter 2", "Winter 2 optimal"),
  Nilai_SSE   = c(SSE2, SSE2.opt),
  Nilai_MSE   = c(MSE2, MSE2.opt),
  Nilai_RMSE  = c(RMSE2, RMSE2.opt)
)

# Hitung MAPE
pred2 <- winter2$fitted[,2]
pred2.opt <- winter2.opt$fitted[,2]
actual2 <- training.ts

MAPE2 <- mean(abs((actual2 - pred2) / actual2)) * 100
MAPE2.opt <- mean(abs((actual2 - pred2.opt) / actual2)) * 100

# Tambahkan MAPE ke data frame
akurasi2.train$Nilai_MAPE <- c(MAPE2, MAPE2.opt)

# Tampilkan tabel lengkap
akurasi2.train
```

**Hasil:** Pada data training, nilai SSE, RMSE, dan MAPE menunjukkan bahwa Winter 1 Optimal lebih akurat dibanding Winter 1 biasa, karena error-nya lebih kecil. Nilai MAPE kurnag dari 30%. Sehingga akurasi prediksi data testing tergolong cukup baik.

#### Akurasi Data Uji

```{r}
#Akurasi Data Testing Winter 2

forecast2.vec <- as.vector(forecast2[,1])
forecast2.opt.vec <- as.vector(forecast2.opt[,1])
testing.vec <- as.vector(testing.ts[,1])

# Hitung selisih dan error untuk data testing
selisih2 <- forecast2.vec - testing.vec
SSEtesting2 <- sum(selisih2^2)
MSEtesting2 <- SSEtesting2 / length(testing.vec)
RMSEtesting2 <- sqrt(MSEtesting2)

selisih2.opt <- forecast2.opt.vec - testing.vec
SSEtesting2.opt <- sum(selisih2.opt^2)
MSEtesting2.opt <- SSEtesting2.opt / length(testing.vec)
RMSEtesting2.opt <- sqrt(MSEtesting2.opt)

# Hitung MAPE untuk data testing
MAPEtesting2 <- mean(abs((testing.vec - forecast2.vec) / testing.vec)) * 100
MAPEtesting2.opt <- mean(abs((testing.vec - forecast2.opt.vec) / testing.vec)) * 100

# Buat data frame akurasi data testing
akurasi2.testing <- data.frame(
  Model_Winter = c("Winter 2", "Winter 2 optimal"),
  Nilai_SSE = c(SSEtesting2, SSEtesting2.opt),
  Nilai_MSE = c(MSEtesting2, MSEtesting2.opt),
  Nilai_RMSE = c(RMSEtesting2, RMSEtesting2.opt),
  Nilai_MAPE = c(MAPEtesting2, MAPEtesting2.opt)
)

# Tampilkan tabel akurasi data testing
akurasi2.testing
```

**Hasil:** Pada data training, nilai SSE, RMSE, dan MAPE menunjukkan bahwa Winter 2 biasa lebih akurat dibanding Winter 2 optimal, karena error-nya lebih kecil. Nilai MAPE lebih dari 30%. Sehingga akurasi prediksi data testing tergolong tidak cukup baik.

## Kesimpulan

1.  **SMA dan DMA**

-   Pada data latih, nilai MAPE metode SMA dan DMA lebih dari 30%, sehingga akurasi prediksi dianggap kurang baik.
-   Pada data uji, SMA memberikan hasil sedikit lebih baik dibanding DMA, namun keduanya tetap tidak cukup akurat.

2.  **Winter (Pemulusan Musiman)**

-   **Winter Aditif (Winter 1)**: Data latih: Winter 1 optimal lebih akurat dibanding Winter 1 biasa (SSE, RMSE, MAPE lebih kecil).\
    Data uji: Winter 1 biasa lebih akurat dibanding Winter 1 optimal, tetapi MAPE \> 30%, sehingga akurasi tidak cukup baik.
-   **Winter Multiplikatif (Winter 2)**: Data latih: Winter 2 optimal lebih akurat dibanding Winter 2 biasa. Data uji: Winter 2 biasa lebih akurat dibanding Winter 2 optimal, namun MAPE \> 30%, sehingga akurasi tidak cukup baik.

3.  **Hasil**

-   Model Winter lebih baik dibanding SMA dan DMA karena mampu menangkap pola musiman.
-   Namun, untuk data uji, semua model masih menunjukkan MAPE \> 30%, sehingga model perlu penyempurnaan agar prediksi lebih akurat.
